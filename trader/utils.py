import asyncio
import random
from contextlib import asynccontextmanager

from .logger import DEFAULT_LOGGER as logging


WORD_LIST = ["time", "year", "work", "life", "part", "case", "fact", "area", "head", "hand", "john", "side", "home", "week", "room", "road", "form", "face", "sort", "body", "name", "book", "view", "door", "line", "city", "kind", "idea", "west", "mind", "land", "care", "back", "rate", "word", "food", "team", "role", "town", "bank", "need", "east", "type", "date", "wife", "club", "lord", "king", "cost", "girl", "game", "love", "news", "rest", "hair", "bill", "fire", "size", "term", "plan", "hall", "list", "loss", "wall", "paul", "army", "unit", "park", "hour", "test", "look", "deal", "help", "page", "risk", "fish", "film", "shop", "site", "mark", "lady", "task", "sale", "lack", "post", "firm", "show", "baby", "base", "miss", "past", "cash", "rule", "turn", "duty", "ball", "race", "edge", "gold", "wood", "text", "foot", "rise", "half", "step", "pain", "hill", "will", "mary", "wind", "band", "farm", "skin", "play", "fear", "move", "rock", "tree", "wine", "star", "hope", "user", "path", "rain", "goal", "seat", "fig.", "pair", "call", "note", "tour", "card", "sign", "fund", "file", "jack", "cell", "lead", "debt", "boat", "heat", "neck", "code", "hell", "coal", "drug", "tony", "alan", "copy", "acid", "vote", "milk", "tape", "flow", "iron", "trip", "lane", "pool", "hole", "flat", "mike", "ship", "meal", "tone", "spot", "fuel", "desk", "fall", "diet", "soil", "roof", "nose", "song", "talk", "link", "ring", "rail", "lake", "bird", "loan", "walk", "mass", "jane", "bush", "bath", "item", "port", "meat", "self", "gate", "mill", "golf", "core", "snow", "camp", "gulf", "ward", "bell", "mail", "tank", "coat", "beer", "mood", "mile", "yard", "boss", "wage", "wave", "duke", "luck", "ruth", "sake", "nick", "salt", "sand", "suit", "soul", "gift", "dark", "dec.", "poll", "hold", "kong", "hong", "moon", "wing", "good", "peak", "aunt", "mode", "andy", "cake", "bond", "disk", "bomb", "host", "tail", "ford", "load", "zone", "pack", "lucy", "dust", "poem", "pipe", "bone", "anna", "earl", "jean", "lift", "jury", "hero", "gene", "cold", "dawn", "harm", "cook", "bowl", "pope", "tool", "male", "drop", "fate", "wire", "silk", "folk", "poet", "hunt", "tale", "belt", "joke", "gaze", "bulk", "root", "stop", "kate", "navy", "knee", "tube", "ease", "rank", "mess", "blow", "ross", "rape", "eric", "lock", "dean", "gear", "bull", "jews", "taxi", "chip", "shit", "bike", "plot", "wool", "coup", "pass", "inch", "tide", "pond", "ride", "rice", "pity", "lamb", "mine", "dose", "disc", "boom", "twin", "clay", "pile", "mate", "grip", "menu", "seed", "prey", "dish", "chap", "mick", "wish", "chin", "rush", "rope", "dear", "beef", "crop", "leaf", "gain", "flag", "dick", "boot", "myth", "gang", "emma", "roll", "quid", "fool", "hull", "deck", "kiss", "isle", "bias", "pole", "tray", "kick", "hint", "tune", "oven", "loch", "nest", "draw", "raid", "evil", "barn", "soup", "down", "trap", "lamp", "blue", "hook", "soap", "palm", "cave", "lion", "wake", "pint", "fame", "dock", "bear", "echo", "duck", "bile", "corn", "jazz", "coin", "plea", "rage", "grid", "beat", "halt", "lace", "stay", "lump", "tent", "clue", "shoe", "jail", "rear", "shah", "carl", "fury", "pact", "bass", "fort", "axis", "lawn", "mask", "gray", "vol.", "pump", "grin", "beam", "hire", "mist", "gall", "sigh", "sink", "horn", "seal", "swan", "cage", "solo", "norm", "cape", "cure", "pine", "exit", "heir", "hood", "dirt", "reed", "sean", "cast", "glen", "shed", "grey", "lung", "sofa", "moor", "slip", "loop", "shaw", "deer", "riot", "cult", "verb", "peat", "fist", "cork", "maid", "calm", "drum", "yarn", "chat", "cart", "exam", "jump", "iris", "fork", "jeff", "dame", "lily", "wolf", "moss", "plus", "feel", "alec", "zero", "sack", "fare", "bail", "gill", "wear", "high", "gown", "fuss", "bang", "toll", "ally", "node", "wash", "glow", "heel", "levy", "stem", "matt", "khan", "trio", "arch", "vein", "dale", "brow", "jill", "toby", "heap", "kite", "tyne", "lang", "noon", "dana", "cafe", "vale", "marc", "para", "urge", "pony", "sail", "doll", "cord", "bite", "foam", "beta", "deed", "watt", "bolt", "coun", "crap", "bend", "herd", "eden", "lime", "knot", "dome", "calf", "rack", "limb", "chef", "jake", "monk", "nail", "noun", "slot", "whip", "hart", "beck", "tomb", "goat", "kohl", "fair", "coke", "stan", "pill", "tear", "pike", "loft", "tyre", "yuan", "gran", "push", "mare", "dusk", "pork", "dole", "acre", "rosa", "junk", "gina", "turf", "polo", "scum", "worm", "leap", "nina", "kemp", "atom", "glue", "spin", "cole", "pier", "hyde", "beth", "bean", "mama", "reef", "arse", "logo", "jess", "rick", "noel", "tsar", "swim", "plug", "roar", "tina", "peer", "main", "dash", "burn", "quiz", "peel", "kirk", "otto", "bloc", "flux", "pick", "punk", "frog", "sony", "writ", "hare", "envy", "buck", "pest", "col.", "vase", "howe", "luce", "tbsp", "cock", "lava", "lust", "bach", "foil", "bait", "mast", "carr", "cane", "quay", "pull", "bark", "vice", "fuck", "bury", "papa", "veil", "gale", "rift", "maze", "todd", "wait", "zinc", "scot", "fold", "nave", "lowe", "bulb", "slab", "fine", "clan", "void", "cone", "prof", "ramp", "gala", "robe", "mesh", "saga", "fife", "mean", "veto", "spur", "dump", "vine", "lass", "liar", "weir", "drag", "jade", "aura", "visa", "icon", "boro", "tram", "tort", "loaf", "ruby", "mint", "leak", "doom", "boar", "tier", "bout", "scar", "hate", "lear", "jeep", "feat", "maud", "womb", "malt", "coil", "carp", "cube", "crag", "haul", "hawk", "butt", "tile", "joey", "ruin", "herb", "mole", "bust", "scan", "rune", "soda", "hank", "tuna", "seam", "prop", "pink", "fore", "want", "make", "flap", "haze", "dell", "fiat", "wade", "muck", "boil", "wang", "eyre", "hymn", "memo", "trek", "zeal", "crab", "crow", "rave", "stud", "safe", "liza", "apex", "pose", "putt", "sage", "frau", "josh", "vera", "kyle", "peck", "till", "dent", "raft", "hose", "font", "rump", "colt", "wild", "hype", "mona", "fuse", "tech", "boon", "open", "tack", "vent", "stab", "ploy", "beak", "stew", "mall", "skye", "dept", "clip", "lima", "holt", "comb", "slum", "slam", "toad", "bowe", "dyke", "harp", "rash", "rite", "plum", "gore", "moat", "ache", "moth", "poly", "gasp", "pore", "knob", "trim", "skip", "mead", "bunk", "helm", "bump", "nova", "chop", "mink", "rust", "chub", "pram", "wasp", "cray", "cove", "gaol", "duct", "bede", "oval", "aide", "vest", "idol", "hale", "piss", "hide", "eddy", "dart", "auto", "pulp", "flaw", "find", "brew", "coma", "epic", "lyon", "ware", "kiev", "foal", "riba", "whim", "slit", "neon", "expo", "foul", "tact", "onus", "surf", "puff", "tart", "slap", "wise", "curl", "sect", "hive", "stag", "lark", "jock", "capt", "enid", "perm", "kerb", "demo", "tait", "sill", "read", "grit", "must", "yale", "hogg", "like", "tick", "porn", "pear", "sway", "spit", "gram", "dial", "rind", "dung", "java", "coca", "yoga", "wren", "chad", "sock", "ling", "cunt", "glyn", "sham", "heck", "trot", "fern", "duel", "reel", "ness", "crux", "cool", "nape", "hick", "blur", "tuck", "midi", "guru", "loco", "mite", "rein", "info", "oral", "dada", "warp", "blot", "stir", "zeta", "sept", "babe", "duff", "yang", "hail", "sole", "hiss", "claw", "dyer", "hang", "toss", "over", "lure", "davy", "berg", "kiwi", "snag", "gull", "nana", "drip", "wick", "soot", "byte", "limp", "shin", "cert", "mule", "cuff", "dope", "flea", "cope", "zest", "slug", "take", "mayo", "tilt", "rake", "kiln", "bran", "flak", "duet", "lull", "thud", "alto", "pang", "brim", "wrap", "taff", "biff", "dune", "sash", "keep", "birt", "pons", "spar", "wink", "fill", "tung", "bray", "ritz", "bash", "axle", "mali", "mace", "tory", "bead", "loom", "hurt", "thaw", "parr", "graf", "casa", "mane", "gist", "glee", "lobe", "vial", "flop", "halo", "moan", "grub", "rota", "chan", "hush", "kill", "nome", "flue", "aria", "buff", "fray", "damn", "lore", "feud", "saul", "cath", "mime", "omen", "twig", "germ", "gait", "jerk", "silt", "zoom", "tang", "ludo", "wand", "kilo", "flex", "muse", "jolt", "pall", "heed", "brit", "gulp", "slag", "hoax", "hilt", "mono", "lego"]  # noqa: E501


class NamedLock:
    def __init__(self):
        self._l = asyncio.Lock()
        self._locks = {}

    @asynccontextmanager
    async def lock(self, name):
        async with self._l:
            if name not in self._locks:
                self._locks[name] = asyncio.Lock()
            lock = self._locks[name]
        try:
            await lock.acquire()
            logging.info(f"Acquiring lock for {name}", color="magenta")
            yield
        finally:
            logging.info(f"Releasing lock for {name}", color="magenta")
            lock.release()


def get_tag():
    return random.choice(WORD_LIST)
